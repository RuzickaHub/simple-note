<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple FS Viewer</title>
  <style>
    :root {
      --bg: #fafafa;
      --text: #111;
      --sidebar-bg: #ffffff;
      --highlight: #2563eb;
    }
    [data-theme="dark"] {
      --bg: #0f0f0f;
      --text: #f1f1f1;
      --sidebar-bg: #181818;
      --highlight: #3b82f6;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: sans-serif;
      display: grid;
      grid-template-columns: 260px 1fr;
      height: 100vh;
    }

    .sidebar {
      background: var(--sidebar-bg);
      border-right: 1px solid #ccc2;
      padding: 10px;
      overflow-y: auto;
    }

    .content {
      padding: 20px;
      overflow-y: auto;
    }

    .toggle-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: var(--sidebar-bg);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #9993;
      cursor: pointer;
    }

    .tree-item {
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 6px;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .tree-item:hover {
      background: #9991;
    }

    .active {
      background: var(--highlight);
      color: white !important;
    }

    .indent {
      margin-left: 18px;
    }

    svg {
      width: 14px;
      height: 14px;
    }
  </style>
</head>
<body data-theme="light">

<button class="toggle-btn" onclick="toggleTheme()">Přepnout téma</button>

<div class="sidebar" id="tree"></div>
<div class="content" id="content">Vyber soubor…</div>

<script>
const apiBase = "https://raw.githubusercontent.com/RuzickaHub/simple-note/main/";

// Minimalistické SVG ikony
const icons = {
  folder: `<svg viewBox='0 0 24 24' fill='none' stroke='currentColor'><path d='M3 6h6l2 2h10v10H3z'/></svg>`,
  file: `<svg viewBox='0 0 24 24' fill='none' stroke='currentColor'><path d='M6 4h9l3 3v13H6z'/></svg>`,
};

async function loadFS(path = "") {
  const res = await fetch(apiBase + path);
  const text = await res.text();
  const lines = text.split("\n");

  const tree = {};

  for (let line of lines) {
    const match = line.match(/href=\"(.*?)\"/);
    if (!match) continue;
    const item = match[1];
    const isFolder = item.endsWith("/");

    const parts = item.split("/").filter(Boolean);
    let curr = tree;
    for (let i = 0; i < parts.length; i++) {
      const p = parts[i];
      if (!curr[p]) curr[p] = { _folder: i < parts.length - 1 || isFolder, _children: {} };
      curr = curr[p]._children;
    }
  }

  renderTree(tree, document.getElementById("tree"));
}

function renderTree(obj, container, indent = 0) {
  container.innerHTML = "";

  Object.keys(obj).forEach(key => {
    const item = obj[key];
    const div = document.createElement("div");
    div.className = "tree-item";
    div.style.marginLeft = indent + "px";
    div.innerHTML = `${item._folder ? icons.folder : icons.file} ${key}`;

    div.onclick = () => {
      document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
      div.classList.add('active');

      if (!item._folder) loadFile(key);
    };

    container.appendChild(div);

    if (item._folder) {
      const childContainer = document.createElement("div");
      container.appendChild(childContainer);
      renderTree(item._children, childContainer, indent + 18);
    }
  });
}

async function loadFile(filename) {
  const res = await fetch(apiBase + filename);
  const text = await res.text();
  document.getElementById("content").innerText = text;
}

function toggleTheme() {
  const body = document.body;
  body.dataset.theme = body.dataset.theme === "dark" ? "light" : "dark";
}

loadFS();
</script>

</body>
</html>
